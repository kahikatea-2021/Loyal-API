require('dotenv').config()
require('./auth').initialize()
const cors = require('cors')
const express = require('express')
require('./imageStorage')
const server = express()
server.use(express.json())

server.use( cors( {
	origin: '*'
} ) )
const cardRoute = require('./routes/cardRoute')
const accountRoute = require('./routes/authRoute')
const storeRoute = require('./routes/storeRoute')
const stampRoute = require('./routes/stampRoute')
const walletRoute = require('./routes/walletRoute')
const { verifyUser } = require('./auth/verifyUser')
const { storeImage } = require('./imageStorage/image')

server.use('/api/v1/account', accountRoute)
server.get('/api/v1/test', (req, res) => {
	storeImage('data:image/png;base64,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')
		.then( res => {
			console.log(res)
		}).catch( err => {
			console.log(err)
		})
})

const userRouter = express.Router()
userRouter.use('/card', cardRoute)
userRouter.use('/stamp', stampRoute)
userRouter.use('/wallet', walletRoute)

const storeRouter = express.Router()
storeRouter.use('/stores', storeRoute)

server.use('/api/v1', verifyUser({ shop: true}), storeRouter)
server.use('/api/v1', verifyUser({ shop: false }), userRouter)

module.exports = server